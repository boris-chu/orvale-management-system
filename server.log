
> orvale-management-system@0.1.0 dev
> next dev -p 80

   ▲ Next.js 15.5.0
   - Local:        http://localhost:80
   - Network:      http://10.10.20.29:80
   - Environments: .env.local

 ✓ Starting...
 ✓ Ready in 1146ms
 ✓ Compiled /api/auth/login in 328ms (427 modules)
🔧 Initializing Orvale Management System database...
✅ Ticket sequences table initialized
✅ Ticket numbering system initialized
🔄 Updating existing tickets with new numbering system...
✅ Database already initialized with 6 users
📊 Found 26 existing tickets to update
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
❌ Error getting accessible queues: [Error: SQLITE_ERROR: no such column: t.email] {
  errno: 1,
  code: 'SQLITE_ERROR'
}
 POST /api/auth/login 200 in 500ms
✅ Updated ticket 1: IM-250818-711
✅ Updated ticket 2: IM-250818-712
✅ Updated ticket 3: IM-250818-713
✅ Updated ticket 4: IM-250818-714
✅ Updated ticket 5: IM-250818-715
✅ Updated ticket 6: IM-250819-143
✅ Updated ticket 7: R7-250819-553
✅ Updated ticket 8: HD-250819-123
✅ Updated ticket 9: R7-250819-554
✅ Updated ticket 10: R7-250819-555
✅ Updated ticket 11: R7-250819-556
✅ Updated ticket 12: R7-250820-148
✅ Updated ticket 13: R7-250820-149
✅ Updated ticket 14: R7-250820-150
✅ Updated ticket 15: R7-250821-276
✅ Updated ticket 16: R7-250821-277
✅ Updated ticket 17: R7-250821-278
✅ Updated ticket 18: R7-250821-279
✅ Updated ticket 19: R7-250821-280
✅ Updated ticket 20: R7-250822-055
✅ Updated ticket 21: HD-250822-181
✅ Updated ticket 22: HD-250822-182
✅ Updated ticket 23: HD-250822-183
✅ Updated ticket 24: HD-250822-184
✅ Updated ticket 25: R7-250825-042
✅ Updated ticket 26: HD-250826-019
🎉 All existing tickets updated successfully!
 ✓ Compiled /middleware in 74ms (114 modules)
 ○ Compiling /chat/public-queue ...
 ✓ Compiled /chat/public-queue in 1357ms (2985 modules)
 GET /chat/public-queue 200 in 1662ms
 ✓ Compiled /api/maintenance/status in 438ms (2992 modules)
🚀 checkMaintenanceStatus called
📋 Querying system settings...
✅ System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
📋 Querying portal settings...
✅ Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
📋 Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔧 Parsing system settings...
🔍 parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
🔍 parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
✅ System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔧 Parsing portal settings...
🔍 parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
🔍 parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
✅ Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
🔍 System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔍 Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
🔍 Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
❌ No token provided in request
 GET /api/maintenance/status 200 in 495ms
 ✓ Compiled /api/public-portal/widget-settings in 334ms (2996 modules)
 GET /api/chat/widget-settings 200 in 380ms
 GET /api/public-portal/widget-settings 200 in 381ms
 GET /api/chat/widget-settings 200 in 20ms
 ✓ Compiled /api/system/init in 207ms (3001 modules)
🚀 Initializing Orvale Management System services...
🔧 Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
✅ App services initialization completed
 POST /api/system/init 200 in 237ms
 ○ Compiling /tickets ...
 ✓ Compiled /tickets in 740ms (3191 modules)
 GET /tickets 200 in 991ms
🚀 checkMaintenanceStatus called
📋 Querying system settings...
✅ System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
📋 Querying portal settings...
✅ Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
📋 Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔧 Parsing system settings...
🔍 parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
🔍 parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
✅ System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔧 Parsing portal settings...
🔍 parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
🔍 parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
✅ Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
🔍 System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔍 Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
🔍 Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
❌ No token provided in request
 GET /api/maintenance/status 200 in 85ms
 GET /api/chat/widget-settings 200 in 23ms
 ○ Compiling / ...
 ✓ Compiled /api/public-portal/queue/guests in 1356ms (3233 modules)
🚀 Initializing Orvale Management System services...
🔧 Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
✅ App services initialization completed
 POST /api/system/init 200 in 514ms
 GET /api/chat/widget-settings 200 in 1628ms
🔍 Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
  Has manage_queue: false
  Has system_settings: false
❌ Permission denied - missing required permissions
 GET /api/public-portal/queue/guests 403 in 1096ms
 GET / 200 in 1643ms
🚀 checkMaintenanceStatus called
📋 Querying system settings...
✅ System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
📋 Querying portal settings...
✅ Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
📋 Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔧 Parsing system settings...
🔍 parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
🔍 parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
✅ System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔧 Parsing portal settings...
🔍 parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
🔍 parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
✅ Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
🔍 System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔍 Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
🔍 Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
❌ No token provided in request
 GET /api/maintenance/status 200 in 24ms
 ✓ Compiled /api/public-portal/available-agents in 385ms (3235 modules)
 GET /api/public-portal/available-agents 200 in 425ms
 GET /api/chat/widget-settings 200 in 424ms
 GET /api/public-portal/available-agents 200 in 16ms
 GET /api/chat/widget-settings 200 in 21ms
 GET /api/public-portal/available-agents 200 in 11ms
 GET /api/public-portal/available-agents 200 in 10ms
🚀 Initializing Orvale Management System services...
🔧 Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
✅ App services initialization completed
 POST /api/system/init 200 in 23ms
🔧 Initializing Orvale Management System database...
✅ Ticket sequences table initialized
✅ Ticket numbering system initialized
🔄 Updating existing tickets with new numbering system...
✅ Database already initialized with 6 users
📊 Found 26 existing tickets to update
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
❌ Error getting accessible queues: [Error: SQLITE_ERROR: no such column: t.email] {
  errno: 1,
  code: 'SQLITE_ERROR'
}
 POST /api/auth/login 200 in 104ms
✅ Updated ticket 1: IM-250818-716
✅ Updated ticket 2: IM-250818-717
✅ Updated ticket 3: IM-250818-718
✅ Updated ticket 4: IM-250818-719
✅ Updated ticket 5: IM-250818-720
✅ Updated ticket 6: IM-250819-144
✅ Updated ticket 7: R7-250819-557
✅ Updated ticket 8: HD-250819-124
✅ Updated ticket 9: R7-250819-558
✅ Updated ticket 10: R7-250819-559
✅ Updated ticket 11: R7-250819-560
✅ Updated ticket 12: R7-250820-151
✅ Updated ticket 13: R7-250820-152
✅ Updated ticket 14: R7-250820-153
✅ Updated ticket 15: R7-250821-281
✅ Updated ticket 16: R7-250821-282
✅ Updated ticket 17: R7-250821-283
✅ Updated ticket 18: R7-250821-284
✅ Updated ticket 19: R7-250821-285
✅ Updated ticket 20: R7-250822-056
✅ Updated ticket 21: HD-250822-185
✅ Updated ticket 22: HD-250822-186
✅ Updated ticket 23: HD-250822-187
✅ Updated ticket 24: HD-250822-188
✅ Updated ticket 25: R7-250825-043
✅ Updated ticket 26: HD-250826-020
🎉 All existing tickets updated successfully!
 GET /tickets 200 in 159ms
🚀 checkMaintenanceStatus called
📋 Querying system settings...
✅ System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
📋 Querying portal settings...
✅ Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
📋 Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔧 Parsing system settings...
🔍 parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
🔍 parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
✅ System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔧 Parsing portal settings...
🔍 parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
🔍 parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
✅ Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
🔍 System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔍 Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
🔍 Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
❌ No token provided in request
 GET /api/maintenance/status 200 in 35ms
 ○ Compiling /api/ticket-data/categories ...
 ✓ Compiled /api/ticket-data/categories in 601ms (3241 modules)
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
 GET /api/ticket-data/organization 200 in 575ms
 GET /api/chat/widget-settings 200 in 576ms
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 684ms
 GET /api/ticket-data/categories 200 in 578ms
 GET /api/ticket-data/organization 200 in 66ms
 ○ Compiling /api/chat/dm ...
 ✓ Compiled /api/chat/dm in 626ms (3247 modules)
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
 GET /api/chat/widget-settings 200 in 695ms
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 699ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
 GET /api/ticket-data/categories 200 in 704ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
 GET /api/chat/ui-settings 200 in 702ms
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
📨 DM API: Loaded 3 direct messages for user e603876
 GET /api/chat/dm 200 in 654ms
 GET /api/chat/channels 200 in 702ms
 ✓ Compiled /api/chat/users in 328ms (3249 modules)
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
🚀 Initializing Orvale Management System services...
🔧 Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
✅ App services initialization completed
 POST /api/system/init 200 in 373ms
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 372ms
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/chat/ui-settings 200 in 372ms
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/chat/channels 200 in 372ms
📨 DM API: Loaded 3 direct messages for user e603876
 GET /api/chat/dm 200 in 373ms
 GET /api/chat/users 200 in 388ms
 ✓ Compiled /api/tickets in 449ms (3251 modules)
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/tickets?status=pending&queue=my_tickets&priority=&sort=newest_first&limit=50 200 in 496ms
 GET /api/chat/users 200 in 486ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/tickets?status=pending&queue=my_tickets&priority=&sort=newest_first&limit=50 200 in 10ms
 GET /chat/public-queue 200 in 196ms
🚀 checkMaintenanceStatus called
📋 Querying system settings...
✅ System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
📋 Querying portal settings...
✅ Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
📋 Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔧 Parsing system settings...
🔍 parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
🔍 parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
✅ System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔧 Parsing portal settings...
🔍 parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
🔍 parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
✅ Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
🔍 System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔍 Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
🔍 Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
❌ No token provided in request
 GET /api/maintenance/status 200 in 37ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 40ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 24ms
 GET /api/chat/widget-settings 200 in 30ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 28ms
 ○ Compiling /api/staff/work-modes ...
 ✓ Compiled /api/staff/work-modes in 631ms (3253 modules)
 GET /api/chat/widget-settings 200 in 659ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
(node:20080) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 exit listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(Use `node --trace-warnings ...` to show where the warning was created)
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 679ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 14ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 25ms
 ○ Compiling /api/public-portal/staff/active-chats ...
 ✓ Compiled /api/public-portal/staff/active-chats in 557ms (3255 modules)
🔍 Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
  Has manage_queue: false
  Has system_settings: false
❌ Permission denied - missing required permissions
 GET /api/public-portal/queue/guests 403 in 593ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
🚀 Initializing Orvale Management System services...
🔧 Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
✅ App services initialization completed
 POST /api/system/init 200 in 356ms
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 593ms
 GET /api/public-portal/staff/active-chats 200 in 620ms
 ✓ Compiled /api/public-portal/queue/staff in 456ms (3257 modules)
🔍 Staff Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
  Has manage_queue: false
  Has system_settings: false
❌ Permission denied - missing required permissions
 GET /api/public-portal/queue/staff 403 in 493ms
 GET /api/public-portal/staff/active-chats 200 in 487ms
 ✓ Compiled in 362ms (1801 modules)
 GET /chat/public-queue 200 in 60ms
 GET /api/public-portal/staff/active-chats 200 in 36ms
 ✓ Compiled in 162ms (1801 modules)
 GET /chat/public-queue 200 in 51ms
 GET /api/public-portal/queue/guests 401 in 25ms
 GET /api/public-portal/staff/active-chats 200 in 29ms
🔧 Initializing Orvale Management System database...
✅ Ticket sequences table initialized
✅ Ticket numbering system initialized
🔄 Updating existing tickets with new numbering system...
✅ Database already initialized with 6 users
📊 Found 26 existing tickets to update
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
❌ Error getting accessible queues: [Error: SQLITE_ERROR: no such column: t.email] {
  errno: 1,
  code: 'SQLITE_ERROR'
}
 POST /api/auth/login 200 in 84ms
✅ Updated ticket 1: IM-250818-721
✅ Updated ticket 2: IM-250818-722
✅ Updated ticket 3: IM-250818-723
✅ Updated ticket 4: IM-250818-724
✅ Updated ticket 5: IM-250818-725
✅ Updated ticket 6: IM-250819-145
✅ Updated ticket 7: R7-250819-561
✅ Updated ticket 8: HD-250819-125
✅ Updated ticket 9: R7-250819-562
✅ Updated ticket 10: R7-250819-563
✅ Updated ticket 11: R7-250819-564
✅ Updated ticket 12: R7-250820-154
✅ Updated ticket 13: R7-250820-155
✅ Updated ticket 14: R7-250820-156
✅ Updated ticket 15: R7-250821-286
✅ Updated ticket 16: R7-250821-287
🔍 Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
✅ Admin role - bypassing permission check
✅ Permission check passed
 GET /api/public-portal/queue/guests 200 in 10ms
✅ Updated ticket 17: R7-250821-288
✅ Updated ticket 18: R7-250821-289
✅ Updated ticket 19: R7-250821-290
✅ Updated ticket 20: R7-250822-057
✅ Updated ticket 21: HD-250822-189
✅ Updated ticket 22: HD-250822-190
✅ Updated ticket 23: HD-250822-191
✅ Updated ticket 24: HD-250822-192
✅ Updated ticket 25: R7-250825-044
✅ Updated ticket 26: HD-250826-021
🎉 All existing tickets updated successfully!
 ✓ Compiled in 159ms (1764 modules)
 GET /chat/public-queue 200 in 48ms
 GET /chat/public-queue 200 in 143ms
 ✓ Compiled /api/auth/user in 143ms (1770 modules)
 ✓ Compiled (1772 modules)
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
🚀 checkMaintenanceStatus called
📋 Querying system settings...
✅ System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
📋 Querying portal settings...
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
📋 Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔧 Parsing system settings...
🔍 parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
🔍 parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
✅ System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔧 Parsing portal settings...
🔍 parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
🔍 parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
✅ Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
🔍 System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔍 Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
🔍 Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
❌ No token provided in request
 GET /api/maintenance/status 200 in 297ms
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 296ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 20ms
 ✓ Compiled /api/staff/work-modes in 127ms (1774 modules)
 ✓ Compiled (1776 modules)
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
 GET /api/chat/widget-settings 200 in 390ms
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 370ms
 GET /api/staff/work-modes 200 in 371ms
 GET /api/chat/widget-settings 200 in 10ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 36ms
🔍 Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
✅ Admin role - bypassing permission check
✅ Permission check passed
✅ Admin role - has all real-time permissions
Queue guests database error: SQLITE_ERROR: no such column: pcm.message_content
 GET /api/public-portal/queue/guests 500 in 43ms
 GET /api/public-portal/staff/active-chats 200 in 49ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 19ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/public-portal/staff/active-chats 200 in 23ms
 GET /api/staff/work-modes 200 in 19ms
 ✓ Compiled /api/public-portal/queue/staff in 247ms (1778 modules)
 ✓ Compiled /api/system/init in 225ms (1783 modules)
🔍 Staff Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
✅ Admin role - bypassing permission check
✅ Permission check passed
✅ Admin role - has all real-time permissions
🚀 Initializing Orvale Management System services...
🔧 Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
✅ App services initialization completed
 POST /api/system/init 200 in 401ms
Staff queue database error: SQLITE_ERROR: no such column: u.user_id
 GET /api/public-portal/queue/staff 500 in 645ms
 GET /chat/public-queue 200 in 394ms
🔧 Initializing Orvale Management System database...
✅ Ticket sequences table initialized
✅ Ticket numbering system initialized
🔄 Updating existing tickets with new numbering system...
✅ Database already initialized with 6 users
📊 Found 26 existing tickets to update
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ Updated ticket 1: IM-250818-726
❌ Error getting accessible queues: [Error: SQLITE_ERROR: no such column: t.email] {
  errno: 1,
  code: 'SQLITE_ERROR'
}
 POST /api/auth/login 200 in 91ms
✅ Updated ticket 2: IM-250818-727
✅ Updated ticket 3: IM-250818-728
✅ Updated ticket 4: IM-250818-729
✅ Updated ticket 5: IM-250818-730
✅ Updated ticket 6: IM-250819-146
✅ Updated ticket 7: R7-250819-565
✅ Updated ticket 8: HD-250819-126
✅ Updated ticket 9: R7-250819-566
✅ Updated ticket 10: R7-250819-567
✅ Updated ticket 11: R7-250819-568
✅ Updated ticket 12: R7-250820-157
✅ Updated ticket 13: R7-250820-158
🔍 Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
✅ Admin role - bypassing permission check
✅ Permission check passed
✅ Admin role - has all real-time permissions
✅ Updated ticket 14: R7-250820-159
Queue guests database error: SQLITE_ERROR: no such column: pcm.message_content
 GET /api/public-portal/queue/guests 500 in 19ms
✅ Updated ticket 15: R7-250821-291
✅ Updated ticket 16: R7-250821-292
✅ Updated ticket 17: R7-250821-293
✅ Updated ticket 18: R7-250821-294
✅ Updated ticket 19: R7-250821-295
✅ Updated ticket 20: R7-250822-058
✅ Updated ticket 21: HD-250822-193
✅ Updated ticket 22: HD-250822-194
✅ Updated ticket 23: HD-250822-195
✅ Updated ticket 24: HD-250822-196
✅ Updated ticket 25: R7-250825-045
✅ Updated ticket 26: HD-250826-022
🎉 All existing tickets updated successfully!
 GET /api/public-portal/staff/active-chats 200 in 32ms
 GET /chat/public-queue 200 in 169ms
🚀 checkMaintenanceStatus called
📋 Querying system settings...
✅ System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
📋 Querying portal settings...
✅ Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
📋 Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔧 Parsing system settings...
🔍 parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
🔍 parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
✅ System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔧 Parsing portal settings...
🔍 parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
🔍 parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
✅ Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
🔍 System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔍 Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
🔍 Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
❌ No token provided in request
 GET /api/maintenance/status 200 in 46ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 51ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 25ms
 GET /api/chat/widget-settings 200 in 32ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 29ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
 GET /api/chat/widget-settings 200 in 28ms
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 33ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 15ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 32ms
🔍 Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
✅ Admin role - bypassing permission check
✅ Permission check passed
✅ Admin role - has all real-time permissions
Queue guests database error: SQLITE_ERROR: no such column: pcm.message_content
 GET /api/public-portal/queue/guests 500 in 35ms
 GET /api/public-portal/staff/active-chats 200 in 39ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 23ms
 GET /api/public-portal/staff/active-chats 200 in 20ms
🔍 Staff Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
✅ Admin role - bypassing permission check
✅ Permission check passed
✅ Admin role - has all real-time permissions
Staff queue database error: SQLITE_ERROR: no such column: u.user_id
 GET /api/public-portal/queue/staff 500 in 12ms
 POST /api/system/init 200 in 25ms
 GET /chat/public-queue 200 in 40ms
🚀 checkMaintenanceStatus called
📋 Querying system settings...
✅ System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
📋 Querying portal settings...
✅ Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
📋 Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔧 Parsing system settings...
🔍 parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
🔍 parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
✅ System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔧 Parsing portal settings...
🔍 parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
🔍 parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
✅ Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
🔍 System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔍 Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
🔍 Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
❌ No token provided in request
 GET /api/maintenance/status 200 in 32ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 35ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 23ms
 GET /api/chat/widget-settings 200 in 27ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 27ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
 GET /api/chat/widget-settings 200 in 21ms
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 29ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 14ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 27ms
🔍 Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
✅ Admin role - bypassing permission check
✅ Permission check passed
✅ Admin role - has all real-time permissions
Queue guests database error: SQLITE_ERROR: no such column: pcm.message_content
 GET /api/public-portal/queue/guests 500 in 28ms
 GET /api/public-portal/staff/active-chats 200 in 34ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 22ms
 GET /api/public-portal/staff/active-chats 200 in 18ms
🔍 Staff Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
✅ Admin role - bypassing permission check
✅ Permission check passed
✅ Admin role - has all real-time permissions
Staff queue database error: SQLITE_ERROR: no such column: u.user_id
 GET /api/public-portal/queue/staff 500 in 12ms
 POST /api/system/init 200 in 22ms
 GET /api/public-portal/staff/active-chats 200 in 26ms
 GET /chat/public-queue 200 in 44ms
🚀 checkMaintenanceStatus called
📋 Querying system settings...
✅ System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
📋 Querying portal settings...
✅ Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
📋 Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔧 Parsing system settings...
🔍 parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
🔍 parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
✅ System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔧 Parsing portal settings...
🔍 parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
🔍 parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
✅ Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
🔍 System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔍 Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
🔍 Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
❌ No token provided in request
 GET /api/maintenance/status 200 in 35ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 39ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 24ms
 GET /api/chat/widget-settings 200 in 29ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 31ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
 GET /api/chat/widget-settings 200 in 27ms
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 33ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 15ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
🔍 Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
✅ Admin role - bypassing permission check
✅ Permission check passed
✅ Admin role - has all real-time permissions
 GET /api/staff/work-modes 200 in 33ms
Queue guests database error: SQLITE_ERROR: no such column: pcm.message_content
 GET /api/public-portal/queue/guests 500 in 33ms
 GET /api/public-portal/staff/active-chats 200 in 38ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 27ms
 GET /api/public-portal/staff/active-chats 200 in 29ms
🔍 Staff Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
✅ Admin role - bypassing permission check
✅ Permission check passed
✅ Admin role - has all real-time permissions
Staff queue database error: SQLITE_ERROR: no such column: u.user_id
 GET /api/public-portal/queue/staff 500 in 13ms
 POST /api/system/init 200 in 26ms
 GET /api/public-portal/staff/active-chats 200 in 24ms
 GET /api/public-portal/staff/active-chats 200 in 29ms
 GET / 200 in 52ms
🚀 checkMaintenanceStatus called
📋 Querying system settings...
✅ System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
📋 Querying portal settings...
✅ Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
📋 Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔧 Parsing system settings...
🔍 parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
🔍 parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
✅ System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔧 Parsing portal settings...
🔍 parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
🔍 parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
✅ Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
🔍 System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔍 Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
🔍 Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
❌ No token provided in request
 GET /api/maintenance/status 200 in 15ms
 ✓ Compiled /api/public-portal/widget-settings in 330ms (1768 modules)
 ✓ Compiled (1772 modules)
 GET /api/public-portal/available-agents 200 in 584ms
 GET /api/public-portal/available-agents 200 in 590ms
 GET /api/public-portal/widget-settings 200 in 589ms
 GET /api/chat/widget-settings 200 in 590ms
 GET /api/public-portal/widget-settings 200 in 587ms
 GET /api/public-portal/widget-settings 200 in 590ms
 GET /api/chat/widget-settings 200 in 21ms
 GET /api/public-portal/widget-settings 200 in 21ms
 GET /api/public-portal/available-agents 200 in 22ms
 GET /api/public-portal/available-agents 200 in 25ms
 ✓ Compiled /api/system/init in 123ms (1777 modules)
🚀 Initializing Orvale Management System services...
🔧 Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
✅ App services initialization completed
 POST /api/system/init 200 in 155ms
 GET / 200 in 127ms
🚀 checkMaintenanceStatus called
📋 Querying system settings...
✅ System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
📋 Querying portal settings...
✅ Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
📋 Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔧 Parsing system settings...
🔍 parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
🔍 parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
✅ System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔧 Parsing portal settings...
🔍 parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
🔍 parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
✅ Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
🔍 System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔍 Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
🔍 Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
❌ No token provided in request
 GET /api/maintenance/status 200 in 31ms
 GET /api/public-portal/available-agents 200 in 26ms
 GET /api/public-portal/available-agents 200 in 34ms
 GET /api/chat/widget-settings 200 in 37ms
 GET /api/chat/widget-settings 200 in 35ms
 GET /api/public-portal/available-agents 200 in 29ms
 GET /api/public-portal/available-agents 200 in 35ms
 POST /api/system/init 200 in 18ms
 GET /api/public-portal/staff/active-chats 200 in 39ms
 GET /api/public-portal/staff/active-chats 200 in 31ms
 ✓ Compiled /api/public-portal/queue/guests in 320ms (1777 modules)
 GET /api/public-portal/queue/guests 401 in 358ms
 GET /chat/public-queue 200 in 66ms
 GET / 200 in 66ms
 GET /api/public-portal/staff/active-chats 200 in 26ms
 GET / 200 in 98ms
🚀 checkMaintenanceStatus called
📋 Querying system settings...
✅ System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
📋 Querying portal settings...
✅ Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
📋 Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔧 Parsing system settings...
🔍 parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
🔍 parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
✅ System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔧 Parsing portal settings...
🔍 parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
🔍 parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
✅ Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
🔍 System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔍 Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
🔍 Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
❌ No token provided in request
 GET /api/maintenance/status 200 in 20ms
 GET /api/public-portal/available-agents 200 in 26ms
 GET /api/chat/widget-settings 200 in 40ms
 GET /api/chat/widget-settings 200 in 37ms
 GET /api/public-portal/available-agents 200 in 38ms
 GET /api/public-portal/available-agents 200 in 30ms
 GET /api/public-portal/available-agents 200 in 34ms
🚀 Initializing Orvale Management System services...
🔧 Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
✅ App services initialization completed
 POST /api/system/init 200 in 27ms
 GET / 200 in 34ms
🚀 checkMaintenanceStatus called
📋 Querying system settings...
✅ System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
📋 Querying portal settings...
✅ Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
📋 Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔧 Parsing system settings...
🔍 parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
🔍 parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
✅ System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔧 Parsing portal settings...
🔍 parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
🔍 parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
✅ Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
🔍 System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔍 Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
🔍 Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
❌ No token provided in request
 GET /api/maintenance/status 200 in 16ms
 GET /api/public-portal/available-agents 200 in 25ms
 GET /api/chat/widget-settings 200 in 32ms
 GET /api/chat/widget-settings 200 in 30ms
 GET /api/public-portal/available-agents 200 in 32ms
 GET /api/public-portal/available-agents 200 in 34ms
 GET /api/public-portal/available-agents 200 in 39ms
 POST /api/system/init 200 in 17ms
 GET / 200 in 38ms
🚀 checkMaintenanceStatus called
📋 Querying system settings...
✅ System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
📋 Querying portal settings...
✅ Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
📋 Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔧 Parsing system settings...
🔍 parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
🔍 parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
✅ System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔧 Parsing portal settings...
🔍 parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
🔍 parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
✅ Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
🔍 System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔍 Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
🔍 Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
❌ No token provided in request
 GET /api/maintenance/status 200 in 13ms
 GET /api/public-portal/available-agents 200 in 22ms
 GET /api/chat/widget-settings 200 in 27ms
 GET /api/chat/widget-settings 200 in 26ms
 GET /api/public-portal/available-agents 200 in 27ms
 GET /api/public-portal/available-agents 200 in 32ms
 GET /api/public-portal/available-agents 200 in 36ms
 POST /api/system/init 200 in 14ms
 GET /api/public-portal/staff/active-chats 200 in 27ms
 ✓ Compiled /api/auth/login in 280ms (1779 modules)
🔧 Initializing Orvale Management System database...
✅ Ticket sequences table initialized
✅ Ticket numbering system initialized
🔄 Updating existing tickets with new numbering system...
✅ Database already initialized with 6 users
📊 Found 26 existing tickets to update
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
❌ Error getting accessible queues: [Error: SQLITE_ERROR: no such column: t.email] {
  errno: 1,
  code: 'SQLITE_ERROR'
}
 POST /api/auth/login 200 in 375ms
✅ Updated ticket 1: IM-250818-731
✅ Updated ticket 2: IM-250818-732
✅ Updated ticket 3: IM-250818-733
✅ Updated ticket 4: IM-250818-734
✅ Updated ticket 5: IM-250818-735
✅ Updated ticket 6: IM-250819-147
✅ Updated ticket 7: R7-250819-569
✅ Updated ticket 8: HD-250819-127
✅ Updated ticket 9: R7-250819-570
✅ Updated ticket 10: R7-250819-571
✅ Updated ticket 11: R7-250819-572
✅ Updated ticket 12: R7-250820-160
✅ Updated ticket 13: R7-250820-161
✅ Updated ticket 14: R7-250820-162
✅ Updated ticket 15: R7-250821-296
✅ Updated ticket 16: R7-250821-297
✅ Updated ticket 17: R7-250821-298
✅ Updated ticket 18: R7-250821-299
✅ Updated ticket 19: R7-250821-300
✅ Updated ticket 20: R7-250822-059
✅ Updated ticket 21: HD-250822-197
✅ Updated ticket 22: HD-250822-198
✅ Updated ticket 23: HD-250822-199
✅ Updated ticket 24: HD-250822-200
✅ Updated ticket 25: R7-250825-046
✅ Updated ticket 26: HD-250826-023
🎉 All existing tickets updated successfully!
 GET /api/public-portal/available-agents 200 in 24ms
🔍 Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
✅ Admin role - bypassing permission check
✅ Permission check passed
✅ Admin role - has all real-time permissions
 GET /api/public-portal/queue/guests 200 in 21ms
🔍 Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
✅ Admin role - bypassing permission check
✅ Permission check passed
✅ Admin role - has all real-time permissions
 GET /api/public-portal/queue/guests 200 in 13ms
 GET /api/public-portal/staff/active-chats 200 in 32ms
 GET /chat/public-queue 200 in 125ms
🚀 checkMaintenanceStatus called
📋 Querying system settings...
✅ System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
📋 Querying portal settings...
✅ Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
📋 Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔧 Parsing system settings...
🔍 parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
🔍 parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
✅ System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔧 Parsing portal settings...
🔍 parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
🔍 parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
✅ Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
🔍 System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔍 Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
🔍 Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
❌ No token provided in request
 GET /api/maintenance/status 200 in 41ms
 ✓ Compiled /api/public-portal/widget-settings in 259ms (1781 modules)
 ✓ Compiled (1783 modules)
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
 GET /api/public-portal/widget-settings 200 in 386ms
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
 GET /api/chat/widget-settings 200 in 387ms
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 449ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 19ms
 GET /api/chat/widget-settings 200 in 22ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 18ms
 ✓ Compiled /api/staff/work-modes in 195ms (1785 modules)
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 258ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 10ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 30ms
🔍 Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
✅ Admin role - bypassing permission check
✅ Permission check passed
✅ Admin role - has all real-time permissions
 GET /api/public-portal/queue/guests 200 in 31ms
 GET /api/public-portal/staff/active-chats 200 in 35ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 19ms
 GET /api/public-portal/staff/active-chats 200 in 16ms
 ✓ Compiled /api/public-portal/queue/staff in 313ms (1787 modules)
 ✓ Compiled in 0ms (1787 modules)
 ✓ Compiled in 0ms (1787 modules)
 ✓ Compiled in 0ms (1787 modules)
🚀 Initializing Orvale Management System services...
🔧 Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
✅ App services initialization completed
 POST /api/system/init 200 in 584ms
🔍 Staff Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
✅ Admin role - bypassing permission check
✅ Permission check passed
✅ Admin role - has all real-time permissions
Staff queue database error: SQLITE_ERROR: no such column: u.department
 GET /api/public-portal/queue/staff 500 in 747ms
 GET /chat/public-queue 200 in 588ms
 GET / 200 in 588ms
 GET /api/public-portal/available-agents 200 in 27ms
🔍 Staff Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
✅ Admin role - bypassing permission check
✅ Permission check passed
✅ Admin role - has all real-time permissions
Staff queue database error: SQLITE_ERROR: no such column: u.department
 GET /api/public-portal/queue/staff 500 in 38ms
 GET /api/public-portal/staff/active-chats 200 in 33ms
 GET /api/public-portal/available-agents 200 in 29ms
 GET /chat/public-queue 200 in 157ms
🚀 checkMaintenanceStatus called
📋 Querying system settings...
✅ System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
📋 Querying portal settings...
✅ Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
📋 Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔧 Parsing system settings...
🔍 parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
🔍 parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
✅ System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔧 Parsing portal settings...
🔍 parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
🔍 parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
✅ Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
🔍 System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔍 Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
🔍 Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
❌ No token provided in request
 GET /api/maintenance/status 200 in 28ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 34ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 22ms
 GET /api/chat/widget-settings 200 in 32ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 26ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
 GET /api/chat/widget-settings 200 in 26ms
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 35ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 13ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 31ms
🔍 Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
✅ Admin role - bypassing permission check
✅ Permission check passed
✅ Admin role - has all real-time permissions
 GET /api/public-portal/queue/guests 200 in 33ms
 GET /api/public-portal/staff/active-chats 200 in 37ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 23ms
 GET /api/public-portal/staff/active-chats 200 in 25ms
🔍 Staff Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
✅ Admin role - bypassing permission check
✅ Permission check passed
✅ Admin role - has all real-time permissions
Staff queue database error: SQLITE_ERROR: no such column: u.department
 GET /api/public-portal/queue/staff 500 in 16ms
🚀 Initializing Orvale Management System services...
🔧 Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
✅ App services initialization completed
 POST /api/system/init 200 in 28ms
 ✓ Compiled in 395ms (1785 modules)
 GET /chat/public-queue 200 in 64ms
 GET / 200 in 64ms
 ✓ Compiled in 143ms (1785 modules)
 GET /chat/public-queue 200 in 71ms
 GET / 200 in 72ms
🔍 Staff Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
✅ Admin role - bypassing permission check
✅ Permission check passed
✅ Admin role - has all real-time permissions
 GET /api/public-portal/queue/staff 200 in 32ms
 GET /chat/public-queue 200 in 100ms
🚀 checkMaintenanceStatus called
📋 Querying system settings...
✅ System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
📋 Querying portal settings...
✅ Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
📋 Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔧 Parsing system settings...
🔍 parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
🔍 parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
✅ System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔧 Parsing portal settings...
🔍 parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
🔍 parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
✅ Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
🔍 System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔍 Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
🔍 Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
❌ No token provided in request
 GET /api/maintenance/status 200 in 27ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 33ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
 GET /api/chat/widget-settings 200 in 22ms
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 23ms
 GET /api/chat/widget-settings 200 in 24ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 31ms
 GET /api/staff/work-modes 200 in 31ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 19ms
🔍 Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
✅ Admin role - bypassing permission check
✅ Permission check passed
✅ Admin role - has all real-time permissions
 GET /api/public-portal/staff/active-chats 200 in 34ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
 GET /api/public-portal/queue/guests 200 in 38ms
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 42ms
🔍 Staff Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
✅ Admin role - bypassing permission check
✅ Permission check passed
✅ Admin role - has all real-time permissions
 GET /api/public-portal/staff/active-chats 200 in 57ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
 GET /api/public-portal/queue/staff 200 in 53ms
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 46ms
🚀 Initializing Orvale Management System services...
🔧 Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
✅ App services initialization completed
 POST /api/system/init 200 in 27ms
 GET /api/public-portal/available-agents 200 in 30ms
 GET /api/public-portal/staff/active-chats 200 in 24ms
 GET /api/public-portal/available-agents 200 in 30ms
 GET /api/public-portal/staff/active-chats 200 in 33ms
 GET /api/public-portal/available-agents 200 in 30ms
 ✓ Compiled in 692ms (3217 modules)
 GET /api/public-portal/staff/active-chats 200 in 52ms
 ✓ Compiled in 237ms (3217 modules)
 GET /api/public-portal/available-agents 200 in 33ms
 GET /api/public-portal/staff/active-chats 200 in 41ms
 GET /api/public-portal/available-agents 200 in 20ms
 GET /api/public-portal/staff/active-chats 200 in 29ms
 GET /api/public-portal/available-agents 200 in 18ms
 GET /api/public-portal/staff/active-chats 200 in 24ms
 GET /api/public-portal/available-agents 200 in 31ms
 GET /api/public-portal/staff/active-chats 200 in 28ms
 GET /api/public-portal/available-agents 200 in 23ms
 GET /api/public-portal/staff/active-chats 200 in 25ms
 GET /api/public-portal/available-agents 200 in 21ms
 GET /api/public-portal/staff/active-chats 200 in 31ms
 GET /api/public-portal/available-agents 200 in 22ms
 GET /api/public-portal/staff/active-chats 200 in 28ms
 GET /api/public-portal/available-agents 200 in 29ms
 ✓ Compiled in 505ms (3217 modules)
 ✓ Compiled in 203ms (3217 modules)
 ✓ Compiled /api/staff/work-modes in 216ms (1764 modules)
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 363ms
 GET /api/public-portal/staff/active-chats 200 in 363ms
 GET /api/public-portal/available-agents 200 in 25ms
 GET / 200 in 175ms
 ✓ Compiled /api/maintenance/status in 363ms (1770 modules)
🚀 checkMaintenanceStatus called
📋 Querying system settings...
✅ System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
📋 Querying portal settings...
✅ Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
📋 Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔧 Parsing system settings...
🔍 parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
🔍 parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
✅ System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔧 Parsing portal settings...
🔍 parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
🔍 parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
✅ Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
🔍 System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔍 Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
🔍 Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
❌ No token provided in request
 GET /api/maintenance/status 200 in 398ms
 ✓ Compiled /api/chat/widget-settings in 169ms (1772 modules)
 ✓ Compiled (1774 modules)
 GET /api/public-portal/widget-settings 200 in 367ms
 GET /api/public-portal/widget-settings 200 in 369ms
 GET /api/public-portal/available-agents 200 in 369ms
 GET /api/public-portal/available-agents 200 in 369ms
 GET /api/chat/widget-settings 200 in 372ms
 GET /api/public-portal/widget-settings 200 in 373ms
 GET /api/public-portal/widget-settings 200 in 21ms
 GET /api/chat/widget-settings 200 in 21ms
 ✓ Compiled /api/system/init in 238ms (1779 modules)
🚀 Initializing Orvale Management System services...
🔧 Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
✅ App services initialization completed
 POST /api/system/init 200 in 401ms
 GET /api/public-portal/available-agents 200 in 298ms
 GET /api/public-portal/available-agents 200 in 300ms
 GET /api/public-portal/staff/active-chats 200 in 36ms
 GET / 200 in 189ms
🚀 checkMaintenanceStatus called
📋 Querying system settings...
✅ System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
📋 Querying portal settings...
✅ Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
📋 Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔧 Parsing system settings...
🔍 parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
🔍 parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
✅ System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔧 Parsing portal settings...
🔍 parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
🔍 parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
✅ Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
🔍 System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔍 Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
🔍 Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
❌ No token provided in request
 GET /api/maintenance/status 200 in 20ms
 GET /api/public-portal/available-agents 200 in 22ms
 GET /api/chat/widget-settings 200 in 35ms
 GET /api/chat/widget-settings 200 in 33ms
 GET /api/public-portal/available-agents 200 in 35ms
 GET /api/public-portal/available-agents 200 in 29ms
 GET /api/public-portal/available-agents 200 in 34ms
 POST /api/system/init 200 in 34ms
 GET /api/public-portal/staff/active-chats 200 in 332ms
 GET /api/public-portal/available-agents 200 in 24ms
 GET /api/public-portal/staff/active-chats 200 in 30ms
 ✓ Compiled in 854ms (3229 modules)
 GET /api/public-portal/available-agents 200 in 53ms
 GET /api/public-portal/staff/active-chats 200 in 39ms
 ✓ Compiled in 389ms (3215 modules)
 ✓ Compiled in 231ms (3215 modules)
 ✓ Compiled /api/auth/user in 173ms (1763 modules)
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 238ms
 ✓ Compiled /api/staff/work-modes in 113ms (1765 modules)
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 167ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 25ms
 ✓ Compiled /api/public-portal/queue/guests in 194ms (1767 modules)
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
🔍 Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
✅ Admin role - bypassing permission check
✅ Permission check passed
✅ Admin role - has all real-time permissions
 GET /api/public-portal/staff/active-chats 200 in 430ms
 GET /api/staff/work-modes 200 in 411ms
 GET /api/public-portal/queue/guests 200 in 432ms
 GET /api/public-portal/staff/active-chats 200 in 13ms
 ✓ Compiled /api/public-portal/queue/staff in 113ms (1769 modules)
🔍 Staff Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
✅ Admin role - bypassing permission check
✅ Permission check passed
✅ Admin role - has all real-time permissions
 GET /api/public-portal/queue/staff 200 in 147ms
 GET /api/public-portal/available-agents 200 in 30ms
 GET /api/public-portal/staff/active-chats 200 in 24ms
 GET /api/public-portal/available-agents 200 in 21ms
 GET /api/public-portal/staff/active-chats 200 in 21ms
 ✓ Compiled in 729ms (3228 modules)
 GET /api/public-portal/available-agents 200 in 31ms
 GET /api/public-portal/staff/active-chats 200 in 51ms
 GET /api/public-portal/available-agents 200 in 21ms
 GET /api/public-portal/staff/active-chats 200 in 36ms
 GET /api/public-portal/available-agents 200 in 51ms
 GET /api/public-portal/staff/active-chats 200 in 28ms
 GET /api/public-portal/available-agents 200 in 26ms
 ✓ Compiled in 505ms (3219 modules)
 GET /api/public-portal/staff/active-chats 200 in 49ms
 ✓ Compiled in 303ms (3219 modules)
 ✓ Compiled in 235ms (3219 modules)
 ✓ Compiled in 257ms (3219 modules)
 GET /api/public-portal/available-agents 200 in 35ms
 ✓ Compiled /api/public-portal/chat/start-session in 353ms (3221 modules)
🔍 Start session request body: {
  "guest_info": {
    "name": "Sophia Clark",
    "email": "SophiaClark@dpss.lacounty.gov",
    "phone": null,
    "department": null
  },
  "initial_message": "The App Freezes When I Switch Tabs"
}
📝 Extracted data: {
  name: 'Sophia Clark',
  email: 'SophiaClark@dpss.lacounty.gov',
  phone: null,
  department: null,
  initialMessage: 'The App Freezes When I Switch Tabs'
}
🎯 Attempting auto-assignment for session guest_1756444707299_ag3s983rk
 ✓ Compiled /api/public-portal/chat/auto-assign in 185ms (3223 modules)
🎯 Auto-assignment request for session guest_1756444707299_ag3s983rk (normal, any dept, escalated: false)
📋 Found 3 available staff members
 POST /api/public-portal/chat/auto-assign 500 in 207ms
⚠️ Auto-assignment failed with status: 500
 POST /api/public-portal/chat/start-session 200 in 600ms
 GET /api/public-portal/staff/active-chats 200 in 37ms
 GET /api/public-portal/staff/active-chats 200 in 22ms
 GET /api/public-portal/staff/active-chats 200 in 23ms
 GET /api/public-portal/staff/active-chats 200 in 26ms
 GET /chat/public-queue 200 in 225ms
 ✓ Compiled /api/auth/user in 488ms (1767 modules)
 ✓ Compiled (1769 modules)
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
🚀 checkMaintenanceStatus called
📋 Querying system settings...
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
📋 Querying portal settings...
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 775ms
✅ Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
📋 Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔧 Parsing system settings...
🔍 parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
🔍 parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
✅ System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔧 Parsing portal settings...
🔍 parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
🔍 parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
✅ Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
🔍 System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
🔍 Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
🔍 Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
🔍 Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
❌ No token provided in request
 GET /api/maintenance/status 200 in 778ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 19ms
 ✓ Compiled /api/staff/work-modes in 129ms (1771 modules)
 ✓ Compiled /api/system/init in 0ms (1775 modules)
 ✓ Compiled in 0ms (1780 modules)
 ✓ Compiled in 1ms (1780 modules)
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
 GET /api/chat/widget-settings 200 in 751ms
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/auth/user 200 in 732ms
 ✓ Compiled in 0ms (1780 modules)
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
 GET /api/public-portal/widget-settings 200 in 902ms
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 886ms
 ✓ Compiled /api/public-portal/queue/guests in 0ms (1780 modules)
🚀 Initializing Orvale Management System services...
🔧 Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
✅ App services initialization completed
 POST /api/system/init 200 in 869ms
 ✓ Compiled in 1ms (1782 modules)
 ✓ Compiled in 0ms (1782 modules)
 GET /api/chat/widget-settings 200 in 766ms
 ✓ Compiled in 1ms (1782 modules)
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 768ms
 GET /api/public-portal/staff/active-chats 200 in 752ms
 ✓ Compiled in 1ms (1782 modules)
🔍 Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
✅ Admin role - bypassing permission check
✅ Permission check passed
✅ Admin role - has all real-time permissions
 GET /api/public-portal/queue/guests 200 in 892ms
 ✓ Compiled /api/public-portal/queue/staff in 0ms (1782 modules)
 ✓ Compiled in 1ms (1784 modules)
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 733ms
🔍 Staff Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
✅ Admin role - bypassing permission check
✅ Permission check passed
✅ Admin role - has all real-time permissions
 GET /api/public-portal/staff/active-chats 200 in 731ms
 GET /api/public-portal/queue/staff 200 in 589ms
🔍 Token found in Authorization header
✅ Token verified for user ID: 185
✅ User found in database: e603876
🔧 Raw user.login_preferences from database: {}
🔍 Fetching permissions for user role: admin
✅ Database permissions found: 105
🔑 User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
✅ User with permissions created, permission count: 105
🔧 Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 14ms
 GET /api/public-portal/staff/active-chats 200 in 37ms
 GET /api/public-portal/staff/active-chats 200 in 34ms
 GET /api/public-portal/staff/active-chats 200 in 31ms
 GET /api/public-portal/staff/active-chats 200 in 32ms
 ✓ Compiled in 662ms (3217 modules)
 GET /api/public-portal/staff/active-chats 200 in 56ms
 GET /api/public-portal/staff/active-chats 200 in 17ms
