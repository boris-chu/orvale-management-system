
> orvale-management-system@0.1.0 dev
> next dev -p 80

   â–² Next.js 15.5.0
   - Local:        http://localhost:80
   - Network:      http://10.10.20.29:80
   - Environments: .env.local

 âœ“ Starting...
 âœ“ Ready in 1146ms
 âœ“ Compiled /api/auth/login in 328ms (427 modules)
ğŸ”§ Initializing Orvale Management System database...
âœ… Ticket sequences table initialized
âœ… Ticket numbering system initialized
ğŸ”„ Updating existing tickets with new numbering system...
âœ… Database already initialized with 6 users
ğŸ“Š Found 26 existing tickets to update
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âŒ Error getting accessible queues: [Error: SQLITE_ERROR: no such column: t.email] {
  errno: 1,
  code: 'SQLITE_ERROR'
}
 POST /api/auth/login 200 in 500ms
âœ… Updated ticket 1: IM-250818-711
âœ… Updated ticket 2: IM-250818-712
âœ… Updated ticket 3: IM-250818-713
âœ… Updated ticket 4: IM-250818-714
âœ… Updated ticket 5: IM-250818-715
âœ… Updated ticket 6: IM-250819-143
âœ… Updated ticket 7: R7-250819-553
âœ… Updated ticket 8: HD-250819-123
âœ… Updated ticket 9: R7-250819-554
âœ… Updated ticket 10: R7-250819-555
âœ… Updated ticket 11: R7-250819-556
âœ… Updated ticket 12: R7-250820-148
âœ… Updated ticket 13: R7-250820-149
âœ… Updated ticket 14: R7-250820-150
âœ… Updated ticket 15: R7-250821-276
âœ… Updated ticket 16: R7-250821-277
âœ… Updated ticket 17: R7-250821-278
âœ… Updated ticket 18: R7-250821-279
âœ… Updated ticket 19: R7-250821-280
âœ… Updated ticket 20: R7-250822-055
âœ… Updated ticket 21: HD-250822-181
âœ… Updated ticket 22: HD-250822-182
âœ… Updated ticket 23: HD-250822-183
âœ… Updated ticket 24: HD-250822-184
âœ… Updated ticket 25: R7-250825-042
âœ… Updated ticket 26: HD-250826-019
ğŸ‰ All existing tickets updated successfully!
 âœ“ Compiled /middleware in 74ms (114 modules)
 â—‹ Compiling /chat/public-queue ...
 âœ“ Compiled /chat/public-queue in 1357ms (2985 modules)
 GET /chat/public-queue 200 in 1662ms
 âœ“ Compiled /api/maintenance/status in 438ms (2992 modules)
ğŸš€ checkMaintenanceStatus called
ğŸ“‹ Querying system settings...
âœ… System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ“‹ Querying portal settings...
âœ… Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
ğŸ“‹ Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ”§ Parsing system settings...
ğŸ” parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
ğŸ” parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
âœ… System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ”§ Parsing portal settings...
ğŸ” parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
ğŸ” parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
âœ… Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ” System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ” Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
ğŸ” Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
âŒ No token provided in request
 GET /api/maintenance/status 200 in 495ms
 âœ“ Compiled /api/public-portal/widget-settings in 334ms (2996 modules)
 GET /api/chat/widget-settings 200 in 380ms
 GET /api/public-portal/widget-settings 200 in 381ms
 GET /api/chat/widget-settings 200 in 20ms
 âœ“ Compiled /api/system/init in 207ms (3001 modules)
ğŸš€ Initializing Orvale Management System services...
ğŸ”§ Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
âœ… App services initialization completed
 POST /api/system/init 200 in 237ms
 â—‹ Compiling /tickets ...
 âœ“ Compiled /tickets in 740ms (3191 modules)
 GET /tickets 200 in 991ms
ğŸš€ checkMaintenanceStatus called
ğŸ“‹ Querying system settings...
âœ… System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ“‹ Querying portal settings...
âœ… Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
ğŸ“‹ Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ”§ Parsing system settings...
ğŸ” parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
ğŸ” parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
âœ… System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ”§ Parsing portal settings...
ğŸ” parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
ğŸ” parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
âœ… Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ” System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ” Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
ğŸ” Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
âŒ No token provided in request
 GET /api/maintenance/status 200 in 85ms
 GET /api/chat/widget-settings 200 in 23ms
 â—‹ Compiling / ...
 âœ“ Compiled /api/public-portal/queue/guests in 1356ms (3233 modules)
ğŸš€ Initializing Orvale Management System services...
ğŸ”§ Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
âœ… App services initialization completed
 POST /api/system/init 200 in 514ms
 GET /api/chat/widget-settings 200 in 1628ms
ğŸ” Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
  Has manage_queue: false
  Has system_settings: false
âŒ Permission denied - missing required permissions
 GET /api/public-portal/queue/guests 403 in 1096ms
 GET / 200 in 1643ms
ğŸš€ checkMaintenanceStatus called
ğŸ“‹ Querying system settings...
âœ… System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ“‹ Querying portal settings...
âœ… Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
ğŸ“‹ Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ”§ Parsing system settings...
ğŸ” parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
ğŸ” parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
âœ… System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ”§ Parsing portal settings...
ğŸ” parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
ğŸ” parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
âœ… Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ” System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ” Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
ğŸ” Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
âŒ No token provided in request
 GET /api/maintenance/status 200 in 24ms
 âœ“ Compiled /api/public-portal/available-agents in 385ms (3235 modules)
 GET /api/public-portal/available-agents 200 in 425ms
 GET /api/chat/widget-settings 200 in 424ms
 GET /api/public-portal/available-agents 200 in 16ms
 GET /api/chat/widget-settings 200 in 21ms
 GET /api/public-portal/available-agents 200 in 11ms
 GET /api/public-portal/available-agents 200 in 10ms
ğŸš€ Initializing Orvale Management System services...
ğŸ”§ Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
âœ… App services initialization completed
 POST /api/system/init 200 in 23ms
ğŸ”§ Initializing Orvale Management System database...
âœ… Ticket sequences table initialized
âœ… Ticket numbering system initialized
ğŸ”„ Updating existing tickets with new numbering system...
âœ… Database already initialized with 6 users
ğŸ“Š Found 26 existing tickets to update
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âŒ Error getting accessible queues: [Error: SQLITE_ERROR: no such column: t.email] {
  errno: 1,
  code: 'SQLITE_ERROR'
}
 POST /api/auth/login 200 in 104ms
âœ… Updated ticket 1: IM-250818-716
âœ… Updated ticket 2: IM-250818-717
âœ… Updated ticket 3: IM-250818-718
âœ… Updated ticket 4: IM-250818-719
âœ… Updated ticket 5: IM-250818-720
âœ… Updated ticket 6: IM-250819-144
âœ… Updated ticket 7: R7-250819-557
âœ… Updated ticket 8: HD-250819-124
âœ… Updated ticket 9: R7-250819-558
âœ… Updated ticket 10: R7-250819-559
âœ… Updated ticket 11: R7-250819-560
âœ… Updated ticket 12: R7-250820-151
âœ… Updated ticket 13: R7-250820-152
âœ… Updated ticket 14: R7-250820-153
âœ… Updated ticket 15: R7-250821-281
âœ… Updated ticket 16: R7-250821-282
âœ… Updated ticket 17: R7-250821-283
âœ… Updated ticket 18: R7-250821-284
âœ… Updated ticket 19: R7-250821-285
âœ… Updated ticket 20: R7-250822-056
âœ… Updated ticket 21: HD-250822-185
âœ… Updated ticket 22: HD-250822-186
âœ… Updated ticket 23: HD-250822-187
âœ… Updated ticket 24: HD-250822-188
âœ… Updated ticket 25: R7-250825-043
âœ… Updated ticket 26: HD-250826-020
ğŸ‰ All existing tickets updated successfully!
 GET /tickets 200 in 159ms
ğŸš€ checkMaintenanceStatus called
ğŸ“‹ Querying system settings...
âœ… System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ“‹ Querying portal settings...
âœ… Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
ğŸ“‹ Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ”§ Parsing system settings...
ğŸ” parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
ğŸ” parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
âœ… System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ”§ Parsing portal settings...
ğŸ” parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
ğŸ” parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
âœ… Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ” System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ” Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
ğŸ” Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
âŒ No token provided in request
 GET /api/maintenance/status 200 in 35ms
 â—‹ Compiling /api/ticket-data/categories ...
 âœ“ Compiled /api/ticket-data/categories in 601ms (3241 modules)
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
 GET /api/ticket-data/organization 200 in 575ms
 GET /api/chat/widget-settings 200 in 576ms
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 684ms
 GET /api/ticket-data/categories 200 in 578ms
 GET /api/ticket-data/organization 200 in 66ms
 â—‹ Compiling /api/chat/dm ...
 âœ“ Compiled /api/chat/dm in 626ms (3247 modules)
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
 GET /api/chat/widget-settings 200 in 695ms
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 699ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
 GET /api/ticket-data/categories 200 in 704ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
 GET /api/chat/ui-settings 200 in 702ms
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
ğŸ“¨ DM API: Loaded 3 direct messages for user e603876
 GET /api/chat/dm 200 in 654ms
 GET /api/chat/channels 200 in 702ms
 âœ“ Compiled /api/chat/users in 328ms (3249 modules)
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
ğŸš€ Initializing Orvale Management System services...
ğŸ”§ Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
âœ… App services initialization completed
 POST /api/system/init 200 in 373ms
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 372ms
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/chat/ui-settings 200 in 372ms
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/chat/channels 200 in 372ms
ğŸ“¨ DM API: Loaded 3 direct messages for user e603876
 GET /api/chat/dm 200 in 373ms
 GET /api/chat/users 200 in 388ms
 âœ“ Compiled /api/tickets in 449ms (3251 modules)
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/tickets?status=pending&queue=my_tickets&priority=&sort=newest_first&limit=50 200 in 496ms
 GET /api/chat/users 200 in 486ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/tickets?status=pending&queue=my_tickets&priority=&sort=newest_first&limit=50 200 in 10ms
 GET /chat/public-queue 200 in 196ms
ğŸš€ checkMaintenanceStatus called
ğŸ“‹ Querying system settings...
âœ… System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ“‹ Querying portal settings...
âœ… Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
ğŸ“‹ Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ”§ Parsing system settings...
ğŸ” parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
ğŸ” parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
âœ… System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ”§ Parsing portal settings...
ğŸ” parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
ğŸ” parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
âœ… Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ” System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ” Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
ğŸ” Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
âŒ No token provided in request
 GET /api/maintenance/status 200 in 37ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 40ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 24ms
 GET /api/chat/widget-settings 200 in 30ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 28ms
 â—‹ Compiling /api/staff/work-modes ...
 âœ“ Compiled /api/staff/work-modes in 631ms (3253 modules)
 GET /api/chat/widget-settings 200 in 659ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
(node:20080) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 exit listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(Use `node --trace-warnings ...` to show where the warning was created)
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 679ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 14ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 25ms
 â—‹ Compiling /api/public-portal/staff/active-chats ...
 âœ“ Compiled /api/public-portal/staff/active-chats in 557ms (3255 modules)
ğŸ” Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
  Has manage_queue: false
  Has system_settings: false
âŒ Permission denied - missing required permissions
 GET /api/public-portal/queue/guests 403 in 593ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
ğŸš€ Initializing Orvale Management System services...
ğŸ”§ Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
âœ… App services initialization completed
 POST /api/system/init 200 in 356ms
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 593ms
 GET /api/public-portal/staff/active-chats 200 in 620ms
 âœ“ Compiled /api/public-portal/queue/staff in 456ms (3257 modules)
ğŸ” Staff Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
  Has manage_queue: false
  Has system_settings: false
âŒ Permission denied - missing required permissions
 GET /api/public-portal/queue/staff 403 in 493ms
 GET /api/public-portal/staff/active-chats 200 in 487ms
 âœ“ Compiled in 362ms (1801 modules)
 GET /chat/public-queue 200 in 60ms
 GET /api/public-portal/staff/active-chats 200 in 36ms
 âœ“ Compiled in 162ms (1801 modules)
 GET /chat/public-queue 200 in 51ms
 GET /api/public-portal/queue/guests 401 in 25ms
 GET /api/public-portal/staff/active-chats 200 in 29ms
ğŸ”§ Initializing Orvale Management System database...
âœ… Ticket sequences table initialized
âœ… Ticket numbering system initialized
ğŸ”„ Updating existing tickets with new numbering system...
âœ… Database already initialized with 6 users
ğŸ“Š Found 26 existing tickets to update
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âŒ Error getting accessible queues: [Error: SQLITE_ERROR: no such column: t.email] {
  errno: 1,
  code: 'SQLITE_ERROR'
}
 POST /api/auth/login 200 in 84ms
âœ… Updated ticket 1: IM-250818-721
âœ… Updated ticket 2: IM-250818-722
âœ… Updated ticket 3: IM-250818-723
âœ… Updated ticket 4: IM-250818-724
âœ… Updated ticket 5: IM-250818-725
âœ… Updated ticket 6: IM-250819-145
âœ… Updated ticket 7: R7-250819-561
âœ… Updated ticket 8: HD-250819-125
âœ… Updated ticket 9: R7-250819-562
âœ… Updated ticket 10: R7-250819-563
âœ… Updated ticket 11: R7-250819-564
âœ… Updated ticket 12: R7-250820-154
âœ… Updated ticket 13: R7-250820-155
âœ… Updated ticket 14: R7-250820-156
âœ… Updated ticket 15: R7-250821-286
âœ… Updated ticket 16: R7-250821-287
ğŸ” Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
âœ… Admin role - bypassing permission check
âœ… Permission check passed
 GET /api/public-portal/queue/guests 200 in 10ms
âœ… Updated ticket 17: R7-250821-288
âœ… Updated ticket 18: R7-250821-289
âœ… Updated ticket 19: R7-250821-290
âœ… Updated ticket 20: R7-250822-057
âœ… Updated ticket 21: HD-250822-189
âœ… Updated ticket 22: HD-250822-190
âœ… Updated ticket 23: HD-250822-191
âœ… Updated ticket 24: HD-250822-192
âœ… Updated ticket 25: R7-250825-044
âœ… Updated ticket 26: HD-250826-021
ğŸ‰ All existing tickets updated successfully!
 âœ“ Compiled in 159ms (1764 modules)
 GET /chat/public-queue 200 in 48ms
 GET /chat/public-queue 200 in 143ms
 âœ“ Compiled /api/auth/user in 143ms (1770 modules)
 âœ“ Compiled (1772 modules)
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
ğŸš€ checkMaintenanceStatus called
ğŸ“‹ Querying system settings...
âœ… System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ“‹ Querying portal settings...
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
ğŸ“‹ Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ”§ Parsing system settings...
ğŸ” parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
ğŸ” parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
âœ… System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ”§ Parsing portal settings...
ğŸ” parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
ğŸ” parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
âœ… Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ” System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ” Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
ğŸ” Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
âŒ No token provided in request
 GET /api/maintenance/status 200 in 297ms
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 296ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 20ms
 âœ“ Compiled /api/staff/work-modes in 127ms (1774 modules)
 âœ“ Compiled (1776 modules)
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
 GET /api/chat/widget-settings 200 in 390ms
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 370ms
 GET /api/staff/work-modes 200 in 371ms
 GET /api/chat/widget-settings 200 in 10ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 36ms
ğŸ” Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
âœ… Admin role - bypassing permission check
âœ… Permission check passed
âœ… Admin role - has all real-time permissions
Queue guests database error: SQLITE_ERROR: no such column: pcm.message_content
 GET /api/public-portal/queue/guests 500 in 43ms
 GET /api/public-portal/staff/active-chats 200 in 49ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 19ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/public-portal/staff/active-chats 200 in 23ms
 GET /api/staff/work-modes 200 in 19ms
 âœ“ Compiled /api/public-portal/queue/staff in 247ms (1778 modules)
 âœ“ Compiled /api/system/init in 225ms (1783 modules)
ğŸ” Staff Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
âœ… Admin role - bypassing permission check
âœ… Permission check passed
âœ… Admin role - has all real-time permissions
ğŸš€ Initializing Orvale Management System services...
ğŸ”§ Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
âœ… App services initialization completed
 POST /api/system/init 200 in 401ms
Staff queue database error: SQLITE_ERROR: no such column: u.user_id
 GET /api/public-portal/queue/staff 500 in 645ms
 GET /chat/public-queue 200 in 394ms
ğŸ”§ Initializing Orvale Management System database...
âœ… Ticket sequences table initialized
âœ… Ticket numbering system initialized
ğŸ”„ Updating existing tickets with new numbering system...
âœ… Database already initialized with 6 users
ğŸ“Š Found 26 existing tickets to update
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… Updated ticket 1: IM-250818-726
âŒ Error getting accessible queues: [Error: SQLITE_ERROR: no such column: t.email] {
  errno: 1,
  code: 'SQLITE_ERROR'
}
 POST /api/auth/login 200 in 91ms
âœ… Updated ticket 2: IM-250818-727
âœ… Updated ticket 3: IM-250818-728
âœ… Updated ticket 4: IM-250818-729
âœ… Updated ticket 5: IM-250818-730
âœ… Updated ticket 6: IM-250819-146
âœ… Updated ticket 7: R7-250819-565
âœ… Updated ticket 8: HD-250819-126
âœ… Updated ticket 9: R7-250819-566
âœ… Updated ticket 10: R7-250819-567
âœ… Updated ticket 11: R7-250819-568
âœ… Updated ticket 12: R7-250820-157
âœ… Updated ticket 13: R7-250820-158
ğŸ” Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
âœ… Admin role - bypassing permission check
âœ… Permission check passed
âœ… Admin role - has all real-time permissions
âœ… Updated ticket 14: R7-250820-159
Queue guests database error: SQLITE_ERROR: no such column: pcm.message_content
 GET /api/public-portal/queue/guests 500 in 19ms
âœ… Updated ticket 15: R7-250821-291
âœ… Updated ticket 16: R7-250821-292
âœ… Updated ticket 17: R7-250821-293
âœ… Updated ticket 18: R7-250821-294
âœ… Updated ticket 19: R7-250821-295
âœ… Updated ticket 20: R7-250822-058
âœ… Updated ticket 21: HD-250822-193
âœ… Updated ticket 22: HD-250822-194
âœ… Updated ticket 23: HD-250822-195
âœ… Updated ticket 24: HD-250822-196
âœ… Updated ticket 25: R7-250825-045
âœ… Updated ticket 26: HD-250826-022
ğŸ‰ All existing tickets updated successfully!
 GET /api/public-portal/staff/active-chats 200 in 32ms
 GET /chat/public-queue 200 in 169ms
ğŸš€ checkMaintenanceStatus called
ğŸ“‹ Querying system settings...
âœ… System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ“‹ Querying portal settings...
âœ… Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
ğŸ“‹ Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ”§ Parsing system settings...
ğŸ” parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
ğŸ” parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
âœ… System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ”§ Parsing portal settings...
ğŸ” parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
ğŸ” parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
âœ… Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ” System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ” Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
ğŸ” Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
âŒ No token provided in request
 GET /api/maintenance/status 200 in 46ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 51ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 25ms
 GET /api/chat/widget-settings 200 in 32ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 29ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
 GET /api/chat/widget-settings 200 in 28ms
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 33ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 15ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 32ms
ğŸ” Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
âœ… Admin role - bypassing permission check
âœ… Permission check passed
âœ… Admin role - has all real-time permissions
Queue guests database error: SQLITE_ERROR: no such column: pcm.message_content
 GET /api/public-portal/queue/guests 500 in 35ms
 GET /api/public-portal/staff/active-chats 200 in 39ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 23ms
 GET /api/public-portal/staff/active-chats 200 in 20ms
ğŸ” Staff Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
âœ… Admin role - bypassing permission check
âœ… Permission check passed
âœ… Admin role - has all real-time permissions
Staff queue database error: SQLITE_ERROR: no such column: u.user_id
 GET /api/public-portal/queue/staff 500 in 12ms
 POST /api/system/init 200 in 25ms
 GET /chat/public-queue 200 in 40ms
ğŸš€ checkMaintenanceStatus called
ğŸ“‹ Querying system settings...
âœ… System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ“‹ Querying portal settings...
âœ… Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
ğŸ“‹ Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ”§ Parsing system settings...
ğŸ” parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
ğŸ” parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
âœ… System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ”§ Parsing portal settings...
ğŸ” parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
ğŸ” parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
âœ… Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ” System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ” Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
ğŸ” Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
âŒ No token provided in request
 GET /api/maintenance/status 200 in 32ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 35ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 23ms
 GET /api/chat/widget-settings 200 in 27ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 27ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
 GET /api/chat/widget-settings 200 in 21ms
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 29ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 14ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 27ms
ğŸ” Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
âœ… Admin role - bypassing permission check
âœ… Permission check passed
âœ… Admin role - has all real-time permissions
Queue guests database error: SQLITE_ERROR: no such column: pcm.message_content
 GET /api/public-portal/queue/guests 500 in 28ms
 GET /api/public-portal/staff/active-chats 200 in 34ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 22ms
 GET /api/public-portal/staff/active-chats 200 in 18ms
ğŸ” Staff Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
âœ… Admin role - bypassing permission check
âœ… Permission check passed
âœ… Admin role - has all real-time permissions
Staff queue database error: SQLITE_ERROR: no such column: u.user_id
 GET /api/public-portal/queue/staff 500 in 12ms
 POST /api/system/init 200 in 22ms
 GET /api/public-portal/staff/active-chats 200 in 26ms
 GET /chat/public-queue 200 in 44ms
ğŸš€ checkMaintenanceStatus called
ğŸ“‹ Querying system settings...
âœ… System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ“‹ Querying portal settings...
âœ… Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
ğŸ“‹ Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ”§ Parsing system settings...
ğŸ” parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
ğŸ” parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
âœ… System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ”§ Parsing portal settings...
ğŸ” parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
ğŸ” parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
âœ… Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ” System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ” Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
ğŸ” Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
âŒ No token provided in request
 GET /api/maintenance/status 200 in 35ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 39ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 24ms
 GET /api/chat/widget-settings 200 in 29ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 31ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
 GET /api/chat/widget-settings 200 in 27ms
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 33ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 15ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
ğŸ” Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
âœ… Admin role - bypassing permission check
âœ… Permission check passed
âœ… Admin role - has all real-time permissions
 GET /api/staff/work-modes 200 in 33ms
Queue guests database error: SQLITE_ERROR: no such column: pcm.message_content
 GET /api/public-portal/queue/guests 500 in 33ms
 GET /api/public-portal/staff/active-chats 200 in 38ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 27ms
 GET /api/public-portal/staff/active-chats 200 in 29ms
ğŸ” Staff Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
âœ… Admin role - bypassing permission check
âœ… Permission check passed
âœ… Admin role - has all real-time permissions
Staff queue database error: SQLITE_ERROR: no such column: u.user_id
 GET /api/public-portal/queue/staff 500 in 13ms
 POST /api/system/init 200 in 26ms
 GET /api/public-portal/staff/active-chats 200 in 24ms
 GET /api/public-portal/staff/active-chats 200 in 29ms
 GET / 200 in 52ms
ğŸš€ checkMaintenanceStatus called
ğŸ“‹ Querying system settings...
âœ… System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ“‹ Querying portal settings...
âœ… Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
ğŸ“‹ Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ”§ Parsing system settings...
ğŸ” parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
ğŸ” parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
âœ… System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ”§ Parsing portal settings...
ğŸ” parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
ğŸ” parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
âœ… Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ” System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ” Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
ğŸ” Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
âŒ No token provided in request
 GET /api/maintenance/status 200 in 15ms
 âœ“ Compiled /api/public-portal/widget-settings in 330ms (1768 modules)
 âœ“ Compiled (1772 modules)
 GET /api/public-portal/available-agents 200 in 584ms
 GET /api/public-portal/available-agents 200 in 590ms
 GET /api/public-portal/widget-settings 200 in 589ms
 GET /api/chat/widget-settings 200 in 590ms
 GET /api/public-portal/widget-settings 200 in 587ms
 GET /api/public-portal/widget-settings 200 in 590ms
 GET /api/chat/widget-settings 200 in 21ms
 GET /api/public-portal/widget-settings 200 in 21ms
 GET /api/public-portal/available-agents 200 in 22ms
 GET /api/public-portal/available-agents 200 in 25ms
 âœ“ Compiled /api/system/init in 123ms (1777 modules)
ğŸš€ Initializing Orvale Management System services...
ğŸ”§ Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
âœ… App services initialization completed
 POST /api/system/init 200 in 155ms
 GET / 200 in 127ms
ğŸš€ checkMaintenanceStatus called
ğŸ“‹ Querying system settings...
âœ… System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ“‹ Querying portal settings...
âœ… Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
ğŸ“‹ Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ”§ Parsing system settings...
ğŸ” parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
ğŸ” parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
âœ… System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ”§ Parsing portal settings...
ğŸ” parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
ğŸ” parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
âœ… Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ” System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ” Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
ğŸ” Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
âŒ No token provided in request
 GET /api/maintenance/status 200 in 31ms
 GET /api/public-portal/available-agents 200 in 26ms
 GET /api/public-portal/available-agents 200 in 34ms
 GET /api/chat/widget-settings 200 in 37ms
 GET /api/chat/widget-settings 200 in 35ms
 GET /api/public-portal/available-agents 200 in 29ms
 GET /api/public-portal/available-agents 200 in 35ms
 POST /api/system/init 200 in 18ms
 GET /api/public-portal/staff/active-chats 200 in 39ms
 GET /api/public-portal/staff/active-chats 200 in 31ms
 âœ“ Compiled /api/public-portal/queue/guests in 320ms (1777 modules)
 GET /api/public-portal/queue/guests 401 in 358ms
 GET /chat/public-queue 200 in 66ms
 GET / 200 in 66ms
 GET /api/public-portal/staff/active-chats 200 in 26ms
 GET / 200 in 98ms
ğŸš€ checkMaintenanceStatus called
ğŸ“‹ Querying system settings...
âœ… System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ“‹ Querying portal settings...
âœ… Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
ğŸ“‹ Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ”§ Parsing system settings...
ğŸ” parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
ğŸ” parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
âœ… System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ”§ Parsing portal settings...
ğŸ” parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
ğŸ” parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
âœ… Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ” System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ” Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
ğŸ” Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
âŒ No token provided in request
 GET /api/maintenance/status 200 in 20ms
 GET /api/public-portal/available-agents 200 in 26ms
 GET /api/chat/widget-settings 200 in 40ms
 GET /api/chat/widget-settings 200 in 37ms
 GET /api/public-portal/available-agents 200 in 38ms
 GET /api/public-portal/available-agents 200 in 30ms
 GET /api/public-portal/available-agents 200 in 34ms
ğŸš€ Initializing Orvale Management System services...
ğŸ”§ Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
âœ… App services initialization completed
 POST /api/system/init 200 in 27ms
 GET / 200 in 34ms
ğŸš€ checkMaintenanceStatus called
ğŸ“‹ Querying system settings...
âœ… System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ“‹ Querying portal settings...
âœ… Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
ğŸ“‹ Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ”§ Parsing system settings...
ğŸ” parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
ğŸ” parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
âœ… System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ”§ Parsing portal settings...
ğŸ” parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
ğŸ” parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
âœ… Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ” System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ” Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
ğŸ” Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
âŒ No token provided in request
 GET /api/maintenance/status 200 in 16ms
 GET /api/public-portal/available-agents 200 in 25ms
 GET /api/chat/widget-settings 200 in 32ms
 GET /api/chat/widget-settings 200 in 30ms
 GET /api/public-portal/available-agents 200 in 32ms
 GET /api/public-portal/available-agents 200 in 34ms
 GET /api/public-portal/available-agents 200 in 39ms
 POST /api/system/init 200 in 17ms
 GET / 200 in 38ms
ğŸš€ checkMaintenanceStatus called
ğŸ“‹ Querying system settings...
âœ… System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ“‹ Querying portal settings...
âœ… Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
ğŸ“‹ Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ”§ Parsing system settings...
ğŸ” parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
ğŸ” parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
âœ… System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ”§ Parsing portal settings...
ğŸ” parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
ğŸ” parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
âœ… Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ” System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ” Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
ğŸ” Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
âŒ No token provided in request
 GET /api/maintenance/status 200 in 13ms
 GET /api/public-portal/available-agents 200 in 22ms
 GET /api/chat/widget-settings 200 in 27ms
 GET /api/chat/widget-settings 200 in 26ms
 GET /api/public-portal/available-agents 200 in 27ms
 GET /api/public-portal/available-agents 200 in 32ms
 GET /api/public-portal/available-agents 200 in 36ms
 POST /api/system/init 200 in 14ms
 GET /api/public-portal/staff/active-chats 200 in 27ms
 âœ“ Compiled /api/auth/login in 280ms (1779 modules)
ğŸ”§ Initializing Orvale Management System database...
âœ… Ticket sequences table initialized
âœ… Ticket numbering system initialized
ğŸ”„ Updating existing tickets with new numbering system...
âœ… Database already initialized with 6 users
ğŸ“Š Found 26 existing tickets to update
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âŒ Error getting accessible queues: [Error: SQLITE_ERROR: no such column: t.email] {
  errno: 1,
  code: 'SQLITE_ERROR'
}
 POST /api/auth/login 200 in 375ms
âœ… Updated ticket 1: IM-250818-731
âœ… Updated ticket 2: IM-250818-732
âœ… Updated ticket 3: IM-250818-733
âœ… Updated ticket 4: IM-250818-734
âœ… Updated ticket 5: IM-250818-735
âœ… Updated ticket 6: IM-250819-147
âœ… Updated ticket 7: R7-250819-569
âœ… Updated ticket 8: HD-250819-127
âœ… Updated ticket 9: R7-250819-570
âœ… Updated ticket 10: R7-250819-571
âœ… Updated ticket 11: R7-250819-572
âœ… Updated ticket 12: R7-250820-160
âœ… Updated ticket 13: R7-250820-161
âœ… Updated ticket 14: R7-250820-162
âœ… Updated ticket 15: R7-250821-296
âœ… Updated ticket 16: R7-250821-297
âœ… Updated ticket 17: R7-250821-298
âœ… Updated ticket 18: R7-250821-299
âœ… Updated ticket 19: R7-250821-300
âœ… Updated ticket 20: R7-250822-059
âœ… Updated ticket 21: HD-250822-197
âœ… Updated ticket 22: HD-250822-198
âœ… Updated ticket 23: HD-250822-199
âœ… Updated ticket 24: HD-250822-200
âœ… Updated ticket 25: R7-250825-046
âœ… Updated ticket 26: HD-250826-023
ğŸ‰ All existing tickets updated successfully!
 GET /api/public-portal/available-agents 200 in 24ms
ğŸ” Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
âœ… Admin role - bypassing permission check
âœ… Permission check passed
âœ… Admin role - has all real-time permissions
 GET /api/public-portal/queue/guests 200 in 21ms
ğŸ” Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
âœ… Admin role - bypassing permission check
âœ… Permission check passed
âœ… Admin role - has all real-time permissions
 GET /api/public-portal/queue/guests 200 in 13ms
 GET /api/public-portal/staff/active-chats 200 in 32ms
 GET /chat/public-queue 200 in 125ms
ğŸš€ checkMaintenanceStatus called
ğŸ“‹ Querying system settings...
âœ… System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ“‹ Querying portal settings...
âœ… Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
ğŸ“‹ Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ”§ Parsing system settings...
ğŸ” parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
ğŸ” parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
âœ… System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ”§ Parsing portal settings...
ğŸ” parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
ğŸ” parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
âœ… Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ” System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ” Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
ğŸ” Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
âŒ No token provided in request
 GET /api/maintenance/status 200 in 41ms
 âœ“ Compiled /api/public-portal/widget-settings in 259ms (1781 modules)
 âœ“ Compiled (1783 modules)
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
 GET /api/public-portal/widget-settings 200 in 386ms
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
 GET /api/chat/widget-settings 200 in 387ms
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 449ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 19ms
 GET /api/chat/widget-settings 200 in 22ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 18ms
 âœ“ Compiled /api/staff/work-modes in 195ms (1785 modules)
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 258ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 10ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 30ms
ğŸ” Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
âœ… Admin role - bypassing permission check
âœ… Permission check passed
âœ… Admin role - has all real-time permissions
 GET /api/public-portal/queue/guests 200 in 31ms
 GET /api/public-portal/staff/active-chats 200 in 35ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 19ms
 GET /api/public-portal/staff/active-chats 200 in 16ms
 âœ“ Compiled /api/public-portal/queue/staff in 313ms (1787 modules)
 âœ“ Compiled in 0ms (1787 modules)
 âœ“ Compiled in 0ms (1787 modules)
 âœ“ Compiled in 0ms (1787 modules)
ğŸš€ Initializing Orvale Management System services...
ğŸ”§ Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
âœ… App services initialization completed
 POST /api/system/init 200 in 584ms
ğŸ” Staff Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
âœ… Admin role - bypassing permission check
âœ… Permission check passed
âœ… Admin role - has all real-time permissions
Staff queue database error: SQLITE_ERROR: no such column: u.department
 GET /api/public-portal/queue/staff 500 in 747ms
 GET /chat/public-queue 200 in 588ms
 GET / 200 in 588ms
 GET /api/public-portal/available-agents 200 in 27ms
ğŸ” Staff Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
âœ… Admin role - bypassing permission check
âœ… Permission check passed
âœ… Admin role - has all real-time permissions
Staff queue database error: SQLITE_ERROR: no such column: u.department
 GET /api/public-portal/queue/staff 500 in 38ms
 GET /api/public-portal/staff/active-chats 200 in 33ms
 GET /api/public-portal/available-agents 200 in 29ms
 GET /chat/public-queue 200 in 157ms
ğŸš€ checkMaintenanceStatus called
ğŸ“‹ Querying system settings...
âœ… System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ“‹ Querying portal settings...
âœ… Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
ğŸ“‹ Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ”§ Parsing system settings...
ğŸ” parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
ğŸ” parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
âœ… System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ”§ Parsing portal settings...
ğŸ” parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
ğŸ” parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
âœ… Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ” System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ” Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
ğŸ” Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
âŒ No token provided in request
 GET /api/maintenance/status 200 in 28ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 34ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 22ms
 GET /api/chat/widget-settings 200 in 32ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 26ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
 GET /api/chat/widget-settings 200 in 26ms
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 35ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 13ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 31ms
ğŸ” Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
âœ… Admin role - bypassing permission check
âœ… Permission check passed
âœ… Admin role - has all real-time permissions
 GET /api/public-portal/queue/guests 200 in 33ms
 GET /api/public-portal/staff/active-chats 200 in 37ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 23ms
 GET /api/public-portal/staff/active-chats 200 in 25ms
ğŸ” Staff Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
âœ… Admin role - bypassing permission check
âœ… Permission check passed
âœ… Admin role - has all real-time permissions
Staff queue database error: SQLITE_ERROR: no such column: u.department
 GET /api/public-portal/queue/staff 500 in 16ms
ğŸš€ Initializing Orvale Management System services...
ğŸ”§ Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
âœ… App services initialization completed
 POST /api/system/init 200 in 28ms
 âœ“ Compiled in 395ms (1785 modules)
 GET /chat/public-queue 200 in 64ms
 GET / 200 in 64ms
 âœ“ Compiled in 143ms (1785 modules)
 GET /chat/public-queue 200 in 71ms
 GET / 200 in 72ms
ğŸ” Staff Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
âœ… Admin role - bypassing permission check
âœ… Permission check passed
âœ… Admin role - has all real-time permissions
 GET /api/public-portal/queue/staff 200 in 32ms
 GET /chat/public-queue 200 in 100ms
ğŸš€ checkMaintenanceStatus called
ğŸ“‹ Querying system settings...
âœ… System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ“‹ Querying portal settings...
âœ… Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
ğŸ“‹ Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ”§ Parsing system settings...
ğŸ” parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
ğŸ” parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
âœ… System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ”§ Parsing portal settings...
ğŸ” parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
ğŸ” parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
âœ… Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ” System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ” Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
ğŸ” Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
âŒ No token provided in request
 GET /api/maintenance/status 200 in 27ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 33ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
 GET /api/chat/widget-settings 200 in 22ms
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 23ms
 GET /api/chat/widget-settings 200 in 24ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 31ms
 GET /api/staff/work-modes 200 in 31ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 19ms
ğŸ” Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
âœ… Admin role - bypassing permission check
âœ… Permission check passed
âœ… Admin role - has all real-time permissions
 GET /api/public-portal/staff/active-chats 200 in 34ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
 GET /api/public-portal/queue/guests 200 in 38ms
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 42ms
ğŸ” Staff Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
âœ… Admin role - bypassing permission check
âœ… Permission check passed
âœ… Admin role - has all real-time permissions
 GET /api/public-portal/staff/active-chats 200 in 57ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
 GET /api/public-portal/queue/staff 200 in 53ms
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 46ms
ğŸš€ Initializing Orvale Management System services...
ğŸ”§ Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
âœ… App services initialization completed
 POST /api/system/init 200 in 27ms
 GET /api/public-portal/available-agents 200 in 30ms
 GET /api/public-portal/staff/active-chats 200 in 24ms
 GET /api/public-portal/available-agents 200 in 30ms
 GET /api/public-portal/staff/active-chats 200 in 33ms
 GET /api/public-portal/available-agents 200 in 30ms
 âœ“ Compiled in 692ms (3217 modules)
 GET /api/public-portal/staff/active-chats 200 in 52ms
 âœ“ Compiled in 237ms (3217 modules)
 GET /api/public-portal/available-agents 200 in 33ms
 GET /api/public-portal/staff/active-chats 200 in 41ms
 GET /api/public-portal/available-agents 200 in 20ms
 GET /api/public-portal/staff/active-chats 200 in 29ms
 GET /api/public-portal/available-agents 200 in 18ms
 GET /api/public-portal/staff/active-chats 200 in 24ms
 GET /api/public-portal/available-agents 200 in 31ms
 GET /api/public-portal/staff/active-chats 200 in 28ms
 GET /api/public-portal/available-agents 200 in 23ms
 GET /api/public-portal/staff/active-chats 200 in 25ms
 GET /api/public-portal/available-agents 200 in 21ms
 GET /api/public-portal/staff/active-chats 200 in 31ms
 GET /api/public-portal/available-agents 200 in 22ms
 GET /api/public-portal/staff/active-chats 200 in 28ms
 GET /api/public-portal/available-agents 200 in 29ms
 âœ“ Compiled in 505ms (3217 modules)
 âœ“ Compiled in 203ms (3217 modules)
 âœ“ Compiled /api/staff/work-modes in 216ms (1764 modules)
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 363ms
 GET /api/public-portal/staff/active-chats 200 in 363ms
 GET /api/public-portal/available-agents 200 in 25ms
 GET / 200 in 175ms
 âœ“ Compiled /api/maintenance/status in 363ms (1770 modules)
ğŸš€ checkMaintenanceStatus called
ğŸ“‹ Querying system settings...
âœ… System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ“‹ Querying portal settings...
âœ… Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
ğŸ“‹ Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ”§ Parsing system settings...
ğŸ” parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
ğŸ” parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
âœ… System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ”§ Parsing portal settings...
ğŸ” parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
ğŸ” parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
âœ… Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ” System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ” Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
ğŸ” Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
âŒ No token provided in request
 GET /api/maintenance/status 200 in 398ms
 âœ“ Compiled /api/chat/widget-settings in 169ms (1772 modules)
 âœ“ Compiled (1774 modules)
 GET /api/public-portal/widget-settings 200 in 367ms
 GET /api/public-portal/widget-settings 200 in 369ms
 GET /api/public-portal/available-agents 200 in 369ms
 GET /api/public-portal/available-agents 200 in 369ms
 GET /api/chat/widget-settings 200 in 372ms
 GET /api/public-portal/widget-settings 200 in 373ms
 GET /api/public-portal/widget-settings 200 in 21ms
 GET /api/chat/widget-settings 200 in 21ms
 âœ“ Compiled /api/system/init in 238ms (1779 modules)
ğŸš€ Initializing Orvale Management System services...
ğŸ”§ Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
âœ… App services initialization completed
 POST /api/system/init 200 in 401ms
 GET /api/public-portal/available-agents 200 in 298ms
 GET /api/public-portal/available-agents 200 in 300ms
 GET /api/public-portal/staff/active-chats 200 in 36ms
 GET / 200 in 189ms
ğŸš€ checkMaintenanceStatus called
ğŸ“‹ Querying system settings...
âœ… System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ“‹ Querying portal settings...
âœ… Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
ğŸ“‹ Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ”§ Parsing system settings...
ğŸ” parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
ğŸ” parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
âœ… System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ”§ Parsing portal settings...
ğŸ” parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
ğŸ” parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
âœ… Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ” System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ” Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
ğŸ” Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
âŒ No token provided in request
 GET /api/maintenance/status 200 in 20ms
 GET /api/public-portal/available-agents 200 in 22ms
 GET /api/chat/widget-settings 200 in 35ms
 GET /api/chat/widget-settings 200 in 33ms
 GET /api/public-portal/available-agents 200 in 35ms
 GET /api/public-portal/available-agents 200 in 29ms
 GET /api/public-portal/available-agents 200 in 34ms
 POST /api/system/init 200 in 34ms
 GET /api/public-portal/staff/active-chats 200 in 332ms
 GET /api/public-portal/available-agents 200 in 24ms
 GET /api/public-portal/staff/active-chats 200 in 30ms
 âœ“ Compiled in 854ms (3229 modules)
 GET /api/public-portal/available-agents 200 in 53ms
 GET /api/public-portal/staff/active-chats 200 in 39ms
 âœ“ Compiled in 389ms (3215 modules)
 âœ“ Compiled in 231ms (3215 modules)
 âœ“ Compiled /api/auth/user in 173ms (1763 modules)
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 238ms
 âœ“ Compiled /api/staff/work-modes in 113ms (1765 modules)
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 167ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 25ms
 âœ“ Compiled /api/public-portal/queue/guests in 194ms (1767 modules)
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
ğŸ” Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
âœ… Admin role - bypassing permission check
âœ… Permission check passed
âœ… Admin role - has all real-time permissions
 GET /api/public-portal/staff/active-chats 200 in 430ms
 GET /api/staff/work-modes 200 in 411ms
 GET /api/public-portal/queue/guests 200 in 432ms
 GET /api/public-portal/staff/active-chats 200 in 13ms
 âœ“ Compiled /api/public-portal/queue/staff in 113ms (1769 modules)
ğŸ” Staff Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
âœ… Admin role - bypassing permission check
âœ… Permission check passed
âœ… Admin role - has all real-time permissions
 GET /api/public-portal/queue/staff 200 in 147ms
 GET /api/public-portal/available-agents 200 in 30ms
 GET /api/public-portal/staff/active-chats 200 in 24ms
 GET /api/public-portal/available-agents 200 in 21ms
 GET /api/public-portal/staff/active-chats 200 in 21ms
 âœ“ Compiled in 729ms (3228 modules)
 GET /api/public-portal/available-agents 200 in 31ms
 GET /api/public-portal/staff/active-chats 200 in 51ms
 GET /api/public-portal/available-agents 200 in 21ms
 GET /api/public-portal/staff/active-chats 200 in 36ms
 GET /api/public-portal/available-agents 200 in 51ms
 GET /api/public-portal/staff/active-chats 200 in 28ms
 GET /api/public-portal/available-agents 200 in 26ms
 âœ“ Compiled in 505ms (3219 modules)
 GET /api/public-portal/staff/active-chats 200 in 49ms
 âœ“ Compiled in 303ms (3219 modules)
 âœ“ Compiled in 235ms (3219 modules)
 âœ“ Compiled in 257ms (3219 modules)
 GET /api/public-portal/available-agents 200 in 35ms
 âœ“ Compiled /api/public-portal/chat/start-session in 353ms (3221 modules)
ğŸ” Start session request body: {
  "guest_info": {
    "name": "Sophia Clark",
    "email": "SophiaClark@dpss.lacounty.gov",
    "phone": null,
    "department": null
  },
  "initial_message": "The App Freezes When I Switch Tabs"
}
ğŸ“ Extracted data: {
  name: 'Sophia Clark',
  email: 'SophiaClark@dpss.lacounty.gov',
  phone: null,
  department: null,
  initialMessage: 'The App Freezes When I Switch Tabs'
}
ğŸ¯ Attempting auto-assignment for session guest_1756444707299_ag3s983rk
 âœ“ Compiled /api/public-portal/chat/auto-assign in 185ms (3223 modules)
ğŸ¯ Auto-assignment request for session guest_1756444707299_ag3s983rk (normal, any dept, escalated: false)
ğŸ“‹ Found 3 available staff members
 POST /api/public-portal/chat/auto-assign 500 in 207ms
âš ï¸ Auto-assignment failed with status: 500
 POST /api/public-portal/chat/start-session 200 in 600ms
 GET /api/public-portal/staff/active-chats 200 in 37ms
 GET /api/public-portal/staff/active-chats 200 in 22ms
 GET /api/public-portal/staff/active-chats 200 in 23ms
 GET /api/public-portal/staff/active-chats 200 in 26ms
 GET /chat/public-queue 200 in 225ms
 âœ“ Compiled /api/auth/user in 488ms (1767 modules)
 âœ“ Compiled (1769 modules)
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
ğŸš€ checkMaintenanceStatus called
ğŸ“‹ Querying system settings...
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… System settings query complete: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ“‹ Querying portal settings...
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 775ms
âœ… Portal settings query complete: [
  {
    settings_json: '{"form_fields":{"name_required":true,"email_required":true,"phone_required":true,"employee_number_required":true,"office_required":true,"section_required":true,"location_required":true,"priority_enabled":true,"attachments_enabled":true,"max_attachments":5,"max_file_size":10,"allowed_file_types":["pdf","doc","docx","txt","jpg","png","gif"]},"display":{"portal_title":"DPSS IT Support Portal","portal_description":"Submit your IT support requests and track their progress","theme_color":"#2563eb","logo_url":"/support.ico","show_category_descriptions":true,"show_estimated_response_time":true,"enable_dark_mode":false,"items_per_page":10},"notifications":{"send_confirmation_email":true,"send_status_updates":true,"send_completion_notification":true,"email_template_confirmation":"Thank you for submitting your support request. Your ticket ID is {{ticket_id}}.","email_template_status_update":"Your support request {{ticket_id}} status has been updated to: {{status}}.","email_template_completion":"Your support request {{ticket_id}} has been completed.","sla_response_time_hours":24,"sla_resolution_time_hours":72,"escalation_enabled":true,"escalation_threshold_hours":48},"integrations":{"enable_api_access":false,"api_rate_limit":100,"webhook_url":"","enable_webhook":false,"external_knowledge_base_url":"","enable_chat_support":false,"enable_remote_assistance":false},"security":{"enable_captcha":false,"enable_file_scanning":true,"allowed_domains":[],"blocked_domains":[],"enable_ip_restrictions":false,"allowed_ip_ranges":[],"session_timeout_minutes":30,"max_login_attempts":5,"enable_audit_logging":true},"user_experience":{"enable_form_data_caching":true,"form_cache_duration_days":30,"enable_auto_save_drafts":true,"enable_form_progress_indicator":true,"enable_smart_form_completion":false},"advanced":{"enable_auto_assignment":true,"enable_smart_routing":false,"enable_duplicate_detection":true,"auto_close_resolved_after_days":7,"enable_satisfaction_survey":true,"enable_knowledge_base_suggestions":false,"enable_priority_escalation":true,"portal_maintenance_mode":false,"portal_maintenance_message":"The DPSS IT Support Portal is currently under maintenance. Please try again later or contact IT support directly.","portal_maintenance_contact":"","portal_maintenance_estimated_end":"","allow_queue_access_during_maintenance":true,"show_system_status_page":true}}'
  }
]
ğŸ“‹ Portal settings converted: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ”§ Parsing system settings...
ğŸ” parseMaintenanceSettings system - settings object: {
  enableMaintenance: false,
  maintenanceMessage: 'System is under maintenance. Please try again later. Okay'
}
ğŸ” parseMaintenanceSettings system - enabledKey: enableMaintenance, value: false (type: boolean), enabled: false
âœ… System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ”§ Parsing portal settings...
ğŸ” parseMaintenanceSettings portal - settings object: {
  maintenance_mode: undefined,
  maintenance_message: undefined,
  portal_maintenance_theme: undefined,
  portal_estimated_return: undefined,
  portal_emergency_contact: undefined
}
ğŸ” parseMaintenanceSettings portal - enabledKey: maintenance_mode, value: undefined (type: undefined), enabled: false
âœ… Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” System settings raw: [
  { setting_key: 'enableMaintenance', setting_value: 'false' },
  {
    setting_key: 'maintenanceMessage',
    setting_value: '"System is under maintenance. Please try again later. Okay"'
  }
]
ğŸ” System config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Portal settings raw: [
  { setting_key: 'maintenance_mode', setting_value: undefined },
  { setting_key: 'maintenance_message', setting_value: undefined },
  { setting_key: 'portal_maintenance_theme', setting_value: undefined },
  { setting_key: 'portal_estimated_return', setting_value: undefined },
  { setting_key: 'portal_emergency_contact', setting_value: undefined }
]
ğŸ” Portal config parsed: {
  enabled: false,
  config: {
    message: 'System is under maintenance. Please try again later.',
    theme: undefined,
    adminOverride: true,
    showRefreshButton: true,
    logChanges: true
  }
}
ğŸ” Final maintenance status: { isSystemMaintenance: false, isPortalMaintenance: false }
ğŸ” Maintenance API Debug: {
  isSystemMaintenance: false,
  isPortalMaintenance: false,
  effectiveMode: 'none',
  hasSystemConfig: true,
  hasPortalConfig: true
}
âŒ No token provided in request
 GET /api/maintenance/status 200 in 778ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 19ms
 âœ“ Compiled /api/staff/work-modes in 129ms (1771 modules)
 âœ“ Compiled /api/system/init in 0ms (1775 modules)
 âœ“ Compiled in 0ms (1780 modules)
 âœ“ Compiled in 1ms (1780 modules)
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
 GET /api/chat/widget-settings 200 in 751ms
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/auth/user 200 in 732ms
 âœ“ Compiled in 0ms (1780 modules)
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
 GET /api/public-portal/widget-settings 200 in 902ms
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 886ms
 âœ“ Compiled /api/public-portal/queue/guests in 0ms (1780 modules)
ğŸš€ Initializing Orvale Management System services...
ğŸ”§ Backup scheduler disabled in development mode
   Use /developer/settings to create manual backups
âœ… App services initialization completed
 POST /api/system/init 200 in 869ms
 âœ“ Compiled in 1ms (1782 modules)
 âœ“ Compiled in 0ms (1782 modules)
 GET /api/chat/widget-settings 200 in 766ms
 âœ“ Compiled in 1ms (1782 modules)
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 768ms
 GET /api/public-portal/staff/active-chats 200 in 752ms
 âœ“ Compiled in 1ms (1782 modules)
ğŸ” Guest Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
âœ… Admin role - bypassing permission check
âœ… Permission check passed
âœ… Admin role - has all real-time permissions
 GET /api/public-portal/queue/guests 200 in 892ms
 âœ“ Compiled /api/public-portal/queue/staff in 0ms (1782 modules)
 âœ“ Compiled in 1ms (1784 modules)
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 733ms
ğŸ” Staff Queue API - Permission Debug:
  User: e603876
  Role: admin
  Permissions Count: 0
âœ… Admin role - bypassing permission check
âœ… Permission check passed
âœ… Admin role - has all real-time permissions
 GET /api/public-portal/staff/active-chats 200 in 731ms
 GET /api/public-portal/queue/staff 200 in 589ms
ğŸ” Token found in Authorization header
âœ… Token verified for user ID: 185
âœ… User found in database: e603876
ğŸ”§ Raw user.login_preferences from database: {}
ğŸ” Fetching permissions for user role: admin
âœ… Database permissions found: 105
ğŸ”‘ User permissions: [
  'admin.maintenance_override',
  'admin.manage_categories',
  'admin.manage_chat_channels',
  'admin.manage_chat_settings',
  'admin.manage_data'
] ...
âœ… User with permissions created, permission count: 105
ğŸ”§ Final user object login_preferences: {}
 GET /api/staff/work-modes 200 in 14ms
 GET /api/public-portal/staff/active-chats 200 in 37ms
 GET /api/public-portal/staff/active-chats 200 in 34ms
 GET /api/public-portal/staff/active-chats 200 in 31ms
 GET /api/public-portal/staff/active-chats 200 in 32ms
 âœ“ Compiled in 662ms (3217 modules)
 GET /api/public-portal/staff/active-chats 200 in 56ms
 GET /api/public-portal/staff/active-chats 200 in 17ms
